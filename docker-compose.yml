services:
  obsidian-sync:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: obsidian-sync
    ports:
      - "${OBSIDIAN_SYNC_PORT:-1312}:1312"  # FastAPI 服務端口
    volumes:
      - ${OBSIDIAN_SYNC_HUGO_CONTENT_ROOT:-/app/obsidian-content/content}:/app/content
      - ${OBSIDIAN_SYNC_HUGO_STATIC_ROOT:-/app/site/static}:/app/static
    environment:
      # Obsidian Sync API 設定
      - OBSIDIAN_SYNC_HOST=${OBSIDIAN_SYNC_HOST:-0.0.0.0}
      - OBSIDIAN_SYNC_PORT=${OBSIDIAN_SYNC_PORT:-1312}
      - OBSIDIAN_SYNC_LOG_LEVEL=${OBSIDIAN_SYNC_LOG_LEVEL:-INFO}
      - PYTHONPATH=/app
    networks:
      - gateway_internal  # 連接到 gateway 的內部網路
    restart: unless-stopped

networks:
  gateway_internal:
    external: true  # 使用 gateway 的內部網路 